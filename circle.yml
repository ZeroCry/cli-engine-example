---
version: 2
executorType: docker
containerInfo:
  - image: dickeyxxx/cli-engine-docker:v1.2.0
stages:
  build:
    workDir: ~/cli-engine-example
    environment:
      - CIRCLE_PROJECT_USERNAME: dickeyxxx
      - CIRCLE_PROJECT_REPONAME: cli-engine-example
      - HEROKU_DEBUG: 1
    steps:
      - type: checkout
      - type: cache-restore
        key: cli-engine-example{{checksum "package.json"}}
      - type: shell
        command: |
          set -exu

          yarn --prefer-offline --pure-lockfile
          ./node_modules/.bin/jest
          ./bin/run cli:test

      - type: test-results-store
        path: /tmp/test-results
      - type: cache-save
        key: cli-engine-example{{checksum "package.json"}}
        paths:
          - /usr/local/share/.cache/yarn
